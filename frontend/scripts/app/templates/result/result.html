<section class="result" ng-show='itinerary == null'>
  <!-- WAITING ANIMATION -->
  <div class='result-waiting' >
    <span class="result-waiting-progress">
      {[ "result_searching" | translate ]}
    </span>
  </div>
</section>

<section class="result" ng-show='itinerary != null'>
  <trip-result-wrapper
          itinerary="itinerary"
          show-alternative-vehicles-panel="showAlternativeVehiclesPanel"
          show-alternative-hotels-panel="showAlternativeHotelsPanel"
          alternative-vehicles="alternativeVehicles"
          alternative-hotels="alternativeHotels"
          alternative-left="alternativeLeft"
          alternative-top="alternativeTop" >

    <!-- RESULT SELECTION PANEL -->
    <div class="result-selection" ng-class="{ 'show': showSelectionPanel }">
      <!-- REFINE SEARCH CONTROL -->
      <div class="result-selection-refine">
        <span class="fa fa-chevron-left result-selection-refine-button" ng-click="refineSearch()"></span>
        <span class="result-selection-refine-text">{[ "result_refine" | translate ]}</span>
      </div>

      <!-- SELECT RESULT TYPE CONTROL -->
      <div class="result-selection-type">
        <span class="result-selection-type-text">{[ "result_select" | translate ]}</span>
        <ul class="result-selection-type-list">
<<<<<<< HEAD
          <li class="result-selection-type-list-item" ng-class="{ active: activeTrip == 0}" ng-click="findTripByBudget()">
            <i class="fa fa-dollar"></i>
            {[ "result_budget_title" | translate ]}
          </li>
          <li class="result-selection-type-list-item" ng-class="{ active: activeTrip == 1, missing: itineraries.length<2 }" ng-click="findTripByTime()">
            <i class="fa fa-clock-o"></i>
            {[ "result_time_title" | translate ]}
          </li>
          <li class="result-selection-type-list-item" ng-class="{ active: activeTrip == 2, missing: itineraries.length<3 }" ng-click="findTripByComfort()">
=======
          <li class="result-selection-type-list-item"
              ng-class="{active: activeTrip == TRIP_TYPE.lowBudget}"
              ng-click="findTripByBudget()">
            <i class="fa fa-dollar"></i>
            {[ "result_budget_title" | translate ]}
          </li>
          <li class="result-selection-type-list-item"
              ng-class="{active: activeTrip == TRIP_TYPE.timeSaving, missing: itineraries.length<2 }"
              ng-click="findTripByTime()">
            <i class="fa fa-clock-o"></i>
            {[ "result_time_title" | translate ]}
          </li>
          <li class="result-selection-type-list-item"
              ng-class="{active: activeTrip == TRIP_TYPE.comfortTrip, missing: itineraries.length<3 }"
              ng-click="findTripByComfort()">
>>>>>>> 8c8312e... Don't search again when going back from booking #201
            <i class="fa fa-diamond"></i>
            {[ "result_comfort_title" | translate ]}
          </li>
        </ul>
      </div>

      <!-- RESULT DETAILS (MOBILE ONLY) -->
      <div class="result-selection-details">
        <div class="result-selection-details-header">
          <span class="result-selection-details-header-label">{[ "result_destination_label" | translate ]}</span>
          <h2 class="result-selection-details-header-title"><i class="fa fa-map-marker"></i>{[ itinerary.destination ]}</h2>
        </div>

        <div class="result-selection-details-item">
          <div class="result-selection-details-item-title">{[ "result_summary_duration" | translate ]}</div>
          <div class="result-selection-details-item-value">{[ itinerary.duration | durationToTime:"%h hrs %m mins" ]}</div>
        </div>
        <div class="result-selection-details-item">
          <div class="result-selection-details-item-title">{[ "result_summary_cost" | translate ]}</div>
          <div class="result-selection-details-item-value">{[ itinerary.cost | price: itinerary.currency ]}</div>
        </div>

        <div class="result-selection-details-more">
          <a class="link" ng-click="toggleSegmentList()">{[ "result_summary_details" | translate ]}</a>
        </div>

        <div class="result-selection-details-action">
          <a class="button--light" ng-click="addToFavorites()">
            <i class="fa fa-heart"></i>{[ "result_favorite_label" | translate ]}
          </a>
          <a class="button" ng-click="bookTrip()">
            <i class="fa fa-shopping-cart"></i>{[ "result_checkout" | translate ]}
          </a>
        </div>
      </div>

      <!-- RESULT LIST CONTROL -->
      <div class="result-selection-list" ng-class="{ visible: showList }">
        <!-- BACK TO DETAILS CONTROL (MOBILE ONLY) -->
        <div class="result-selection-list-close" ng-click="toggleSegmentList()">
          <i class="fa fa-close"></i>{[ "result_summary_back" | translate ]}
        </div>
        <div class="trip-segments-container">
          <trip-segments
                  itinerary="itinerary"
                  active-segments="activeSegments"
                  selected-segment="selectedSegment"
                  active-segments-number="activeSegmentsNumber"
                  show-map-fn="toggleSelectionPanel()">
          </trip-segments>
        </div>
      </div>
    </div>

    <!-- ALTERNATIVES PANELS -->
    <div class="result-alternatives">
      <div ng-show="showAlternativeVehiclesPanel"
           class="trip-segments-alternatives"
           ng-style="{left: alternativeLeft, top: alternativeTop, position: 'absolute'}">
        <alternative-mean-of-travel
                itinerary="itinerary"
                alternatives="alternativeVehicles"
                active-segments="activeSegments"
                active-segments-number="activeSegmentsNumber">
        </alternative-mean-of-travel>
      </div>
      <div ng-show="showAlternativeHotelsPanel"
           class="trip-segments-alternatives"
           ng-style="{left: alternativeLeft, top: alternativeTop, position: 'absolute'}">
        <alternative-hotels
                itinerary="itinerary"
                alternatives="alternativeHotels"
                selected-segment="selectedSegment">
        </alternative-hotels>
      </div>
    </div>

    <!-- RESULT INFORMATION PANEL -->
    <div class="result-panel" ng-class="{ 'full-width': !showSelectionPanel }">
      <div class="result-panel-summary">
        <!-- RESULT  HEADER -->
        <div class="result-panel-summary-header">
          <h2 class="result-panel-summary-header-title"><i class="fa fa-map-marker"></i>{[ itinerary.destination ]}</h2>
          <span class="result-panel-summary-header-link"><a ng-click="toggleInfoPanel()">
            <span ng-if="showInfoPanel">{[ "result_summary_hide" | translate ]}</span>
            <span ng-if="!showInfoPanel">{[ "result_summary_details" | translate ]}</span>
          </a></span>
          <span ng-if="showInfoPanel" class="result-panel-summary-header-appointment">
            <span>{[ "result_summary_appointment" | translate | capitalize ]}:</span>
            <span ng-if="isSingleDay">
              {[ itinerary.appointmentStart | date: "dd.MM.yyyy" ]},
              {[ itinerary.appointmentStart | date: "H:mm" ]}-{[ itinerary.appointmentEnd | date: "H:mm" ]}
            </span>
            <span ng-if="!isSingleDay">
              {[ itinerary.appointmentStart | date: "dd.MM.yyyy, H:mm" ]}-{[ itinerary.appointmentEnd | date: "dd.MM.yyyy, H:mm" ]}
            </span>
          </span>
        </div>
        <!-- RESULT SUMMARY -->
        <div class="result-panel-summary-details" ng-show="showInfoPanel">
          <span class="result-panel-summary-details-item">
            <span class="tooltip"
                  title="{[ activeSegmentsNumber == 0 ? 'result_summary_start_before' : 'result_summary_start_after' | translate ]}"
                  ng-click="toggleTooltip(1)"
                  ng-class="{ show: tooltip == 1}">
              <i class="fa" ng-class="{ 'fa-home': activeSegmentsNumber == 0, 'fa-flag' : activeSegmentsNumber == 1 }"></i>
            </span>
            <span>{[ activeSegments[0].departureTime | date:"d.M.yyyy hh:mm" ]}</span>
          </span>
          <span class="result-panel-summary-details-item">
            <span class="tooltip"
                  title="{[ activeSegmentsNumber == 0 ? 'result_summary_destination_before' : 'result_summary_destination_after' | translate ]}"
                  ng-click="toggleTooltip(2)"
                  ng-class="{ show: tooltip == 2}">
              <i class="fa" ng-class="{ 'fa-flag': activeSegmentsNumber == 0, 'fa-home' : activeSegmentsNumber == 1 }"></i>
            </span>
            <span>{[ activeSegments[activeSegments.length - 1].arrivalTime | date: "d.M.yyyy hh:mm" ]}</span>
          </span>
          <span class="result-panel-summary-details-item">
            <span class="tooltip"
                  title="{[ activeSegmentsNumber == 0 ? 'result_summary_time_before' : 'result_summary_time_after' | translate ]}"
                  ng-click="toggleTooltip(3)"
                  ng-class="{ show: tooltip == 3}">
              <i class="fa fa-clock-o"></i>
            </span>
            <span ng-if="activeSegmentsNumber == 0">{[ getTimeBeforeMeeting(activeSegments) | durationToTime: "%h hrs %m mins" ]}</span>
            <span ng-if="activeSegmentsNumber == 1">{[ getTimeAfterMeeting(activeSegments) | durationToTime: "%h hrs %m mins" ]}</span>
          </span>
        </div>
      </div>

      <div class="result-panel-controls">
        <span class="result-panel-controls-price" ng-show="showInfoPanel">
          {[ itinerary.cost | price: itinerary.currency ]}
        </span>
        <span class="result-panel-controls-time" ng-show="showInfoPanel">
          {[ itinerary.duration | durationToTime:"%h hrs %m mins" ]}
        </span>

        <div class="result-panel-controls-buttons">
          <a class="button--light result-panel-controls-buttons-favorites" ng-click="addToFavorites()" ng-show="showInfoPanel">
            <i class="fa fa-heart"></i><span>{[ "result_favorite_label" | translate ]}</span>
          </a>
          <a class="button" ng-click="bookTrip()">
            <i class="fa fa-shopping-cart"></i>{[ "result_checkout" | translate ]}
          </a>
        </div>
      </div>
    </div>
    <!-- RESULT MAP CONTROL -->
    <div class="result-selection-toggle" ng-class="{ close: showSelectionPanel }" ng-click="toggleSelectionPanel()"></div>
    <div class="result-map" ng-class="{ 'full-width': !showSelectionPanel }">
      <map itinerary="itinerary"
           active-segments="activeSegments"
           selected-segment="selectedSegment"></map>
    </div>
  </trip-result-wrapper>
</section>
